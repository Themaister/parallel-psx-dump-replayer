add_custom_target(shaders)

set(GLSL_FLAGS -mfmt=c)
function(add_shader OUTPUT INPUT)
   add_custom_command(
      OUTPUT ${CMAKE_BINARY_DIR}/glsl/${OUTPUT}.inc 
      COMMAND glslc ${ARGN} -o ${CMAKE_BINARY_DIR}/glsl/${OUTPUT}.inc ${GLSL_FLAGS} ${CMAKE_CURRENT_SOURCE_DIR}/${INPUT}
      DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/${INPUT}
      IMPLICIT_DEPENDS CXX ${CMAKE_CURRENT_SOURCE_DIR}/${INPUT}
      )
   add_custom_target(${OUTPUT} DEPENDS ${CMAKE_BINARY_DIR}/glsl/${OUTPUT}.inc)
   set_source_files_properties(${CMAKE_BINARY_DIR}/glsl/${OUTPUT}.inc PROPERTIES GENERATED TRUE)
   add_dependencies(shaders ${OUTPUT})
endfunction(add_shader)

if (VRAM_ATLAS)
   set(VRAM_ATLAS_DEFINE "-DVRAM_ATLAS")
else()
   set(VRAM_ATLAS_DEFINE "")
endif()
add_shader(opaque.flat.vert primitive.vert -DFLAT ${VRAM_ATLAS_DEFINE})
add_shader(opaque.flat.frag primitive.frag -DFLAT ${VRAM_ATLAS_DEFINE})
add_shader(opaque.textured.vert primitive.vert -DTEXTURED -DOPAQUE ${VRAM_ATLAS_DEFINE})
add_shader(opaque.textured.frag primitive.frag -DTEXTURED -DOPAQUE ${VRAM_ATLAS_DEFINE})
add_shader(semitrans.opaque.textured.frag primitive.frag -DTEXTURED -DSEMI_TRANS_OPAQUE ${VRAM_ATLAS_DEFINE})
add_shader(semitrans.trans.textured.frag primitive.frag -DTEXTURED -DSEMI_TRANS ${VRAM_ATLAS_DEFINE})
add_shader(feedback.add.frag primitive_feedback.frag -DTEXTURED -DBLEND_ADD ${VRAM_ATLAS_DEFINE})
add_shader(feedback.avg.frag primitive_feedback.frag -DTEXTURED -DBLEND_AVG ${VRAM_ATLAS_DEFINE})
add_shader(feedback.sub.frag primitive_feedback.frag -DTEXTURED -DBLEND_SUB ${VRAM_ATLAS_DEFINE})
add_shader(feedback.add_quarter.frag primitive_feedback.frag -DTEXTURED -DBLEND_ADD_QUARTER ${VRAM_ATLAS_DEFINE})
add_shader(feedback.flat.add.frag primitive_feedback.frag -DBLEND_ADD)
add_shader(feedback.flat.avg.frag primitive_feedback.frag -DBLEND_AVG)
add_shader(feedback.flat.sub.frag primitive_feedback.frag -DBLEND_SUB)
add_shader(feedback.flat.add_quarter.frag primitive_feedback.frag -DBLEND_ADD_QUARTER)
add_shader(resolve.scaled.comp resolve.comp -DSCALED)
add_shader(resolve.unscaled.2.comp resolve.comp -DUNSCALED -DSCALE=2)
add_shader(resolve.unscaled.4.comp resolve.comp -DUNSCALED -DSCALE=4)
add_shader(resolve.unscaled.8.comp resolve.comp -DUNSCALED -DSCALE=8)
add_shader(quad.vert quad.vert)
add_shader(unscaled.quad.frag quad.frag -DUNSCALED)
add_shader(scaled.quad.frag quad.frag -DSCALED)
add_shader(bpp24.quad.frag quad.frag -DUNSCALED -DBPP24)
add_shader(copy_vram.comp copy_vram.comp)
add_shader(copy_vram.masked.comp copy_vram.comp -DMASKED)
add_shader(blit_vram.scaled.comp blit_vram.comp -DSCALED)
add_shader(blit_vram.unscaled.comp blit_vram.comp -DUNSCALED)
add_shader(blit_vram.masked.scaled.comp blit_vram.comp -DSCALED -DMASKED)
add_shader(blit_vram.masked.unscaled.comp blit_vram.comp -DUNSCALED -DMASKED)
add_shader(upload.scaled.comp upload.comp -DSCALED)
add_shader(upload.unscaled.comp upload.comp -DUNSCALED)
add_shader(upload.pal4.comp upload.comp -DPAL4)
add_shader(upload.pal8.comp upload.comp -DPAL8)
add_shader(mipmap.vert mipmap.vert)
add_shader(mipmap.shifted.vert mipmap.vert -DSHIFT_QUAD)
add_shader(mipmap.resolve.frag mipmap_resolve.frag)
add_shader(mipmap.energy.first.frag mipmap_energy.frag -DFIRST_PASS)
add_shader(mipmap.energy.frag mipmap_energy.frag)

